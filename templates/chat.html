<!DOCTYPE html>
<html>
<head>
    <title>Ask a question</title>
    <script>
    </script>
</head>
<body>
    <a href="/" class="back-btn" aria-label="Back to upload page">&#8592; Back</a>
    <div class="chat-container">
        <div class="step-indicator">
            <span class="step">1</span>
            <span class="step">2</span>
            <span class="step active">3</span>
        </div>
        <h1 class="chat-title">Ask a question about the video</h1>
        <div class="suggestion-bar">
            <b>Suggestions:</b>
            <span class="suggestion" onclick="setSuggestion('What is the main topic of the video?')">Main topic</span> |
            <span class="suggestion" onclick="setSuggestion('Who are the participants?')">Participants</span> |
            <span class="suggestion" onclick="setSuggestion('What decisions were made?')">Decisions</span> |
            <span class="suggestion" onclick="setSuggestion('What are the action items?')">Action items</span> |
            <span class="suggestion" onclick="setSuggestion('Summarize the video.')">Summary</span> |
            <span class="suggestion" onclick="setSuggestion('List all names mentioned in the transcript.')">List names</span> |
            <span class="suggestion" onclick="setSuggestion('Extract all dates or times mentioned.')">Extract dates/times</span> |
            <span class="suggestion" onclick="setSuggestion('What was the most important quote?')">Important quote</span> |
            <span class="suggestion" onclick="setSuggestion('What is the overall sentiment of the discussion?')">Sentiment</span> |
            <span class="suggestion" onclick="setSuggestion('Summarize the first half of the video.')">First half summary</span> |
            <span class="suggestion" onclick="setSuggestion('Summarize the second half of the video.')">Second half summary</span> |
            <span class="suggestion" onclick="setSuggestion('What are the next steps discussed?')">Next steps</span> |
            <span class="suggestion" onclick="setSuggestion('Who asked the most questions?')">Most questions</span> |
            <span class="suggestion" onclick="setSuggestion('What problems or challenges were discussed?')">Problems/challenges</span> |
            <span class="suggestion" onclick="setSuggestion('What recommendations were given?')">Recommendations</span>
        </div>
        <div class="input-row">
            <input type="text" id="question" placeholder="Type your question..." maxlength="200" autocomplete="off">
            <button class="send-btn" onclick="sendQuestion()">Send</button>
        </div>
        <div id="loading" class="loading-spinner" style="display:none;"></div>
        <div id="toast" class="toast"></div>
        <div class="response-card animated" id="response-card" style="display:none;">
            <div class="qa-label">Response</div>
            <div id="response-question" class="qa-question"></div>
            <div id="response-answer" class="qa-answer"></div>
        </div>
    </div>
    <script>
        function setSuggestion(text) {
            document.getElementById('question').value = text;
            document.getElementById('question').focus();
        }
        function showToast(msg) {
            const toast = document.getElementById('toast');
            toast.innerText = msg;
            toast.classList.add('show-toast');
            toast.style.display = 'block';
            setTimeout(() => {
                toast.classList.remove('show-toast');
                toast.style.display = 'none';
            }, 2500);
        }
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }
        function sendQuestion() {
            const user_input = document.getElementById('question').value.trim();
            if (!user_input) {
                showToast('Please enter a question.');
                return;
            }
            showLoading(true);
            document.getElementById('response-card').style.display = 'none';
            fetch('/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: `prompt=${encodeURIComponent(user_input)}`
            })
            .then(response => response.json())
            .then(data => {
                showLoading(false);
                document.getElementById('response-question').innerText = 'Q: ' + user_input;
                document.getElementById('response-answer').innerText = data.response;
                const card = document.getElementById('response-card');
                card.style.display = 'block';
                card.classList.remove('fade-in');
                void card.offsetWidth; // trigger reflow
                card.classList.add('fade-in');
            })
            .catch(err => {
                showLoading(false);
                console.error('Fetch error:', err);
                showToast('Error: Unable to get response. Check server connection.');
            });
        }
        document.getElementById('question').addEventListener('keydown', function(e) {
            if (e.key === 'Enter') sendQuestion();
        });
    </script>
    <style>
        .back-btn {
            position: absolute;
            left: 32px;
            top: 20px;
            color: #0074d9;
            background: #eaf6ff;
            border-radius: 8px;
            padding: 8px 18px;
            text-decoration: none;
            font-weight: 600;
            font-size: 1rem;
            transition: background 0.2s, color 0.2s;
            z-index: 10;
        }
        .back-btn:hover {
            background: #0074d9;
            color: #fff;
        }
        .step-indicator {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 18px;
        }
        .step {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: #eaf6ff;
            color: #0074d9;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 7px;
            font-size: 1.1rem;
            transition: background 0.2s, color 0.2s;
        }
        .step.active {
            background: #0074d9;
            color: #fff;
        }
        .animated.fade-in {
            animation: fadeInCard 0.8s cubic-bezier(.4,1.7,.6,1) 1;
        }
        @keyframes fadeInCard {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .show-toast {
            animation: fadeInToast 0.5s;
        }
        @keyframes fadeInToast {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</body>
</html>
